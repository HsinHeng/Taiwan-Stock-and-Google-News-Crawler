# apt-get install python-mysqldb
# pip install sqlalchemy

import sys

from modules.reader import getConfig, getStockList
from modules.crawler import Crawler
from modules.mysqlclient import MySQLClient

if __name__ == '__main__':
    result, conf = getConfig()
   
    if not result:
        print "[Error] Failed to read config file"
        sys.exit(1)

    stocks = getStockList(conf.get('file'))

    if not stocks:
        print "[Error] Failed to read csv file"
        sys.exit(1)

    crawler = Crawler(conf.get('url'), stocks)
    dbclient = MySQLClient(conf.get('user'), conf.get('password'), conf.get('host'), conf.get('dbname'))
    dbclient.commit(crawler.run())
    sys.exit(0)
